var vrToken=null,vrPlacement=void 0===_cfg.videoRewardsPlacement?"Home_Screen":_cfg.videoRewardsPlacement,vrProvider=null,googleVREvent=null,vrCloseQueue=[];function vrIOSCall(e){var o="iOS_IronSource_"+e,d=Array.prototype.slice.call(arguments,1);0==d.length&&d.push("");var r=window.webkit.messageHandlers[o];r.postMessage.apply(r,d)}function VRRewardedVideoPlacementCapped(e){"ios"==_cfg.app?vrIOSCall("isRewardedVideoPlacementCapped",e):MRInterface.ironRewardedVideoPlacementCapped(e)}function VRWatchVideo(e,o){var d=new Date,r=(d.getMonth()+1).toString(),a=d.getDate().toString()+"/"+r+"/"+d.getFullYear().toString();localStorage.getItem("clicked_video_reward_date")&&localStorage.getItem("clicked_video_reward_date")==a||(sendEvent("clicked_video_reward_offer",{placement:o}),localStorage.setItem("clicked_video_reward_date",a)),"ios"==_cfg.app?(vrIOSCall("setRewardedVideoServerParameters",{token:e}),setTimeout((function(){vrIOSCall("showRewardedVideo",o)}),100)):(MRInterface.ironRewardedVideoServerParameters(JSON.stringify({token:e})),setTimeout((function(){MRInterface.ironRewardedVideo(o)}),100)),$(".vr-bottom").hide()}function onIronInitialized(){"ios"==_cfg.app?vrIOSCall("isRewardedVideoAvailable"):MRInterface.ironSourceIsRewardedVideoAvailable()}function onRewardedVideoAdOpened(){pendingVideoReward(),console.log("onRewardedVideoAdOpened",arguments)}function onRewardedVideoAdRewarded(){console.log("onRewardedVideoAdRewarded",arguments),VRRewardedVideoPlacementCapped(vrPlacement);var e="ios"==_cfg.app?"rewardAmount":"rewardedAmount";watchedVideoReward(arguments[0][e])}function onRewardedVideoAdClosed(){console.log("onRewardedVideoAdClosed",arguments),clearVRCloseQueue()}function onRewardedVideoAvailabilityChanged(e){console.log("onRewardedVideoAvailabilityChanged",arguments),console.log(e),e&&VRRewardedVideoPlacementCapped(vrPlacement)}function onRewardedVideoPlacementInfo(e){vrProvider="ironsource","string"==typeof e&&(e=JSON.parse(e));var o="ios"==_cfg.app?"rewardAmount":"rewardedAmount";document.getElementById("vr_popup_text").innerHTML=_("Consigue %s <u>gratis</u> ahora",trans("CREDITS_N",{creditsCount:e[o]})),"false"==localStorage.getItem("vr_session")?$(".vr-bottom").hide():$(".vr-bottom").show()}function onRewardedVideoPlacementCapped(e){0==e?$(".vr-bottom").length&&("android"==_cfg.app?MRInterface.ironRewardedVideoPlacementInfo(vrPlacement):"ios"==_cfg.app&&vrIOSCall("getRewardedVideoPlacementInfo",vrPlacement)):$(".vr-bottom").hide(),console.log("onRewardedVideoPlacementCapped",arguments)}function onRewardedVideoAdShowFailed(){console.log("onRewardedVideoAdShowFailed",arguments)}function onRewardedVideoAdClicked(){console.log("onRewardedVideoAdClicked",arguments)}function onRewardedVideoAdStarted(){console.log("onRewardedVideoAdStarted",arguments)}function onRewardedVideoAdEnded(){console.log("onRewardedVideoAdEnded",arguments)}function onVideoAvailabilityChanged(){console.log("onVideoAvailabilityChanged",arguments)}function createVideoReward(){$.ajax({url:"ajax/create_video_reward",data:{id_user:_cfg.user.id,placement:vrPlacement},success:function(e){vrToken=String(e.data.token),placement=e.data.placement,"ironsource"==vrProvider?VRWatchVideo(vrToken,placement):"google"==vrProvider&&pendingVideoReward()}})}function pendingVideoReward(){vrToken&&$.ajax({url:"ajax/video_reward_pending",data:{token:vrToken},success:function(e){console.log("Reward pending")}})}function watchedVideoReward(e){vrToken&&($.ajax({url:"ajax/video_reward_watched",data:{token:vrToken},success:function(e){console.log("Video Reward watched")}}),updateCredits(_cfg.user.credits+e),vrCloseQueue.push((function(){toast(_("%s créditos gratis añadidos",e),"green")})))}function rewardedVideoReward(e){vrToken&&$.ajax({url:"ajax/video_reward_rewarded",data:{token:vrToken,credits:e},success:function(e){console.log("Video Reward rewarded")}})}function clearVRCloseQueue(){for(var e=vrCloseQueue.length;e--;)vrCloseQueue[e](),vrCloseQueue.splice(e,1)}function newGoogleVideoReward(e){vrProvider="google",googleVREvent=e,$(".vr-bottom").show()}function grantGoogleVideoReward(e){watchedVideoReward(e),rewardedVideoReward(e)}function closedGoogleVideoReward(){clearVRCloseQueue()}$(document).ready((function(){if(_cfg.showVideoRewardsToUser)if("false"!=localStorage.getItem("vr_session")){var e=new Date,o=(e.getMonth()+1).toString(),d=e.getDate().toString()+"/"+o+"/"+e.getFullYear().toString();if("android"==_cfg.app){if("undefined"==typeof MRInterface||void 0===MRInterface.ironSetUserID)return;return MRInterface.ironSetUserID(_cfg.user.id.toString()),MRInterface.ironSourceSetConsent(!0),MRInterface.ironSourceInit(["rewardedvideo","interstitial","banner"]),void(localStorage.getItem("seen_video_reward_date")&&localStorage.getItem("seen_video_reward_date")==d||(sendEvent("seen_video_reward_offer",{placement:vrPlacement}),localStorage.setItem("seen_video_reward_date",d)))}if("ios"==_cfg.app){if(void 0===window.webkit||void 0===window.webkit.messageHandlers.iOS_IronSource_init)return;vrIOSCall("setUserID",_cfg.user.id.toString()),vrIOSCall("setConsent",!0),vrIOSCall("init",["rewardedvideo","interstitial","banner"]),localStorage.getItem("seen_video_reward_date")&&localStorage.getItem("seen_video_reward_date")==d||(sendEvent("seen_video_reward_offer",{placement:vrPlacement}),localStorage.setItem("seen_video_reward_date",d))}}else $(".vr-bottom").hide();else console.log("NO VR",_cfg.showVideoRewardsToUser)})),$("body").on("click",".btn-vr-open",(function(e){createVideoReward(),$(".vr-bottom").hide(),"google"==vrProvider&&googleVREvent.makeRewardedVisible()})),$("body").on("click",".btn-vr-close",(function(e){$(".vr-bottom").hide(),localStorage.setItem("vr_session","false")}));
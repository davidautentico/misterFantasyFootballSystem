function add_position(a,e){e=parseInt(e),a=parseInt(a);var s=$("#pos-"+a),t='<li id="pos-'+a+'" class="btn btn-popup" data-popup="admin/settings/payments/positions/amount" data-position="'+a+'" data-amount="'+e+'"><div class="title">'+a+'º</div><div class="subtitle">'+thousands(e)+"</div></li>";if(s.length>0&&e>0)s.replaceWith(t);else if(s.length>0&&e<=0)s.remove();else if(e>0){var n=$("#admin-payments-positions-list");n.append(t);var i=n.children("li");i.detach().sort((function(a,e){return parseInt($(a).data("position"))>parseInt($(e).data("position"))?1:-1})),n.append(i)}}function add_member(a,e,s){s=parseInt(s),a=parseInt(a);var t=$("#member-"+a),n='<li id="member-'+a+'" class="btn btn-popup" data-popup="admin/tools/payments/member" data-member_id="'+a+'" data-amount="'+s+'"><div class="title">'+e+'</div><div class="subtitle '+(s>0?"green":"red")+'">'+thousands(s)+"</div></li>";if(t.length>0&&0===s)t.remove();else if(t.length>0)t.replaceWith(n);else if(0!==s){var i=$("#admin-payments-members");i.append(n);var o=i.children("li");o.detach().sort((function(a,e){return parseInt($(a).data("amount"))>parseInt($(e).data("amount"))?-1:1})),i.append(o)}}sws["users-balances"]={title:_("Saldo de los rivales"),post:"users-balances"},sws.teams={title:_("Equipos"),post:"teams"},sws.admin={title:1==data.other.admin?_("Administrar liga"):_("Configuración de la liga")},sws["admin/settings/general"]={title:_("General")},sws["admin/settings/teams"]={title:_("Equipos")},sws["admin/settings/market"]={title:_("Mercado")},sws["admin/settings/offers-bids-clauses"]={title:_("Ofertas, pujas y cláusulas")},sws["admin/settings/gameweeks"]={title:_("Jornadas")},sws["admin/settings/payments"]={title:_("Bonificaciones")},sws["admin/settings/payments/positions"]={title:_("Bonificar por clasificación de la jornada")},sws["admin/settings/pools"]={title:_("Porras y quinielas")},sws["admin/settings/purchases"]={title:_("Compras por créditos")},sws["admin/tools/payments"]={title:_("Bonificar o penalizar miembros")},sws["admin/tools/members"]={title:_("Gestión de miembros")},sws["admin/tools/cancel-transfers"]={title:_("Cancelar fichajes"),post:"cancel-transfers"};var req_leave={admin:!1,check:!1};function callback_admin_setting(a){data.admin[a.key]=a.value;var e,s,t=$("#admin-"+a.key),n=a.key,i="boolean"==typeof i?+a.value:a.value;"new_member"==n?e=(s={1:_("COMMUNITY_RANDOM_PLAYERS_BALANCE_TEAM_VALUE",data.admin.startingPlayers,data.admin.startingBalance/1e6),2:_("COMMUNITY_NO_PLAYERS_BALANCE",data.admin.startingBalance/1e6),3:_("COMMUNITY_RANDOM_PLAYERS_HALF_BALANCE",data.admin.startingPlayers,data.admin.startingBalance/2e6),4:_("COMMUNITY_RANDOM_PLAYERS_NO_BALANCE",data.admin.startingPlayers)})[i]:"new_season"==n?e=(s={1:_("COMMUNITY_RANDOM_PLAYERS_BALANCE_TEAM_VALUE",data.admin.startingPlayers,data.admin.startingBalance/1e6),2:_("COMMUNITY_NO_PLAYERS_BALANCE",data.admin.startingBalance/1e6),3:_("COMMUNITY_KEEP_TEAM_1_10_BALANCE",data.admin.startingBalance/1e7),4:_("COMMUNITY_RANDOM_PLAYERS_HALF_BALANCE",data.admin.startingPlayers,data.admin.startingBalance/2e6),5:_("COMMUNITY_RANDOM_PLAYERS_NO_BALANCE",data.admin.startingPlayers),6:_("COMMUNITY_KEEP_TEAM_KEEP_BALANCE")})[i]:"provider"==n?(s={as:trans("as"),marca:trans("marca"),marca_stats:trans("marca_stats"),md:trans("md"),mr:trans("mr"),mix:trans("mix",{competitionId:data.admin.id_competition}),mix2:trans("mix2"),cls:trans("cls")},_cfg.whitelabel&&"marca"===_cfg.brandInternalName&&(s.mix2=s.marca_stats),e=s[i]):["team_limit","club_limit","sale_limit"].indexOf(n)>-1?(0===i&&(i=_("ilimitado")),e=i):["clauses","purchase_formations","purchase_changes","purchase_clauses","purchase_rescind","purchase_shields","purchase_show_bids","purchase_salaries","allow_joins","show_balances","min_offer","loans","live_changes","pools","market_players_active","market_offers_active","salaries"].indexOf(n)>-1?e=(s={0:_("No"),1:_("Sí")})[i]:"clauses_signs"==n?e=0===i?_("Desactivado"):1==i?trans("HOURS_N",{hoursCount:24}):2==i?trans("HOURS_N",{hoursCount:72}):trans("DAYS_N",{daysCount:7}):"clauses_daily"==n||"max_inbound_clauses"==n?0===i?e=_("Desactivado"):i<3?(i=1==i?1:3,e=_("%s jugadores por día",i)):(i=3==i?1:3,e=_("%s jugadores por día",i)):"clauses_gameweek"==n?e=0===i?_("Desactivado"):_("%s horas previas al inicio",24*i):"transfer_wait"==n?e=0===i?_("Sin espera"):i<4?trans("HOURS_N",{hoursCount:24*i}):trans("DAYS_N",{daysCount:4}):"loans_floor"==n?e=0===i?_("Ninguno"):_("%s%% del valor del jugador",i):"max_debt"==n?e=0===i?_("Saldo actual"):-1==i?_("Ilimitado"):_("Saldo actual + 1/%s del valor del equipo",i):"pools_format"==n?e=(s={quiniela:_("Quiniela (1X2)"),porra:_("Porra")})[i]:"market_speed"==n?(s={1:_("Normal"),2:_("Intenso"),3:_("Muy intenso")},1==i?(data.admin.mid_cycle_offer=a.mid_cycle_offer,e=1==a.mid_cycle_offer?_("Normal (con oferta adicional a las 17:00)"):_("Normal (sin oferta adicional a las 17:00)")):e=s[i]):"market_stay"==n?e=(s={1:_("Un ciclo"),2:_("Dos ciclos")})[i]:"direct_transfer"==n?e=(s={0:_("En el siguiente ciclo de mercado"),1:_("De forma inmediata")})[i]:"max_inactive_weeks"==n?e=0===i||null===i?_("Nunca"):_("Tras %s semanas",i):"salaries_calcul"==n?e=(s={1:_("COMMUNITY_WAGES_LINEUP"),2:_("COMMUNITY_WAGES_TEAM")})[i]:"salaries_quantity"==n?e=_("Porcentaje sobre el valor (%s%%)",i):"name"==n?(e=i,$(".league-name").text(i),$("#sidebar .communities .active span:not(.custom)").text(i)):"community_icon"==n?(e=i,_cfg.user.communities[_cfg.user.id_community].community_icon=i,changeSidebarCommunityIcon(i)):"custom_rules"==n?e=i.length>50?i.substring(0,50)+"…":i:"pools_prize"==n?e=thousands(e):"max_number_live_changes"==n&&(e=-1==i?_("Ilimitado"):i),t.data("read")||t.find(".subtitle").text(e),"clauses"==n&&updateClausesOptions(a.value)}function updateClausesOptions(a){0===a?($("#admin-clauses_block").removeClass("btn-popup").addClass("btn-clauses-inactive"),$("#admin-clauses_signs").removeClass("btn-popup").addClass("btn-clauses-inactive"),$("#admin-clauses_daily").removeClass("btn-popup").addClass("btn-clauses-inactive"),$("#admin-max_inbound_clauses").removeClass("btn-popup").addClass("btn-clauses-inactive"),$("#admin-clauses_gameweek").removeClass("btn-popup").addClass("btn-clauses-inactive")):($("#admin-clauses_block").addClass("btn-popup").removeClass("btn-clauses-inactive"),$("#admin-clauses_signs").addClass("btn-popup").removeClass("btn-clauses-inactive"),$("#admin-clauses_daily").addClass("btn-popup").removeClass("btn-clauses-inactive"),$("#admin-max_inbound_clauses").addClass("btn-popup").removeClass("btn-clauses-inactive"),$("#admin-clauses_gameweek").addClass("btn-popup").removeClass("btn-clauses-inactive"))}function changeSidebarCommunityIcon(a){var e=$("#sidebar .communities .active .emoji");e.text(a),0===a.length&&e.text(_cfg.user.communities[_cfg.user.id_community].flag_emoji)}function callback_admin(a){var e=!1;if("prizes"==a.action){data.admin.prizes=a.prizes;var s=a.prizes.points>0?_("%s por punto",thousands(a.prizes.points)):_("No");$("#admin-payments-points .subtitle").text(s);var t=a.prizes.best_xi>0?_("%s por jugador",thousands(a.prizes.best_xi)):_("No");$("#admin-payments-best-xi .subtitle").text(t);var n=a.prizes.goals>0?_("%s por gol",thousands(a.prizes.goals)):_("No");$("#admin-payments-goals .subtitle").text(n);var i=a.prizes.fixed>0?_("%s por jornada",thousands(a.prizes.fixed)):_("No");$("#admin-payments-fixed .subtitle").text(i),$("#add").data("position",a.next),a.new_position&&add_position(a.new_position.position,a.new_position.amount)}else"block"==a.action||"unblock"==a.action||"kick"==a.action||"add_admin"==a.action||"remove_admin"==a.action?e="more#admin/tools/members":"reset-points"==a.action?e="standings":"reset-all"==a.action||"cancel_transfers"==a.action?e="feed":"remove"==a.action?(toast(_("Liga eliminada")),e="feed"):"recover"==a.action?toast(_("Email enviado")):"pools_teams"==a.action&&(e="more#admin/settings/pools");return e}function callback_other(a){var e=!1;return"leave"==a.action&&(e="/feed"),e}function callback_toggle_admin(a,e){data.admin[a.option]=a.state,"clauses_signs"==a.option?e.find("p").text(1==a.state?_("Activado"):_("Desactivado")):e.find("p").text(1==a.state?_("Sí"):_("No"))}function check_admin_name(a){""===a.value?input_error(a,_("Nombre incorrecto")):input_ok(a)}function check_admin_market_players(a){var e=parseInt(a.value.replace(/[\.|,|\s]/g,""));e<0||e>20?input_error(a,_("Valor incorrecto")):input_ok(a)}function check_admin_prizes_points(a){var e=parseInt(a.value.replace(/[\.|,|\s]/g,""));e<0||e>1e6?input_error(a,_("Valor incorrecto")):input_ok(a)}function check_admin_prizes_positions(a){var e=parseInt(a.value.replace(/[\.|,|\s]/g,""));e<0||e>1e7?input_error(a,_("Valor incorrecto")):input_ok(a)}function check_admin_prizes_best_xi(a){check_admin_prizes_positions(a)}function check_admin_prizes_goals(a){check_admin_prizes_points(a)}function check_admin_prizes_fixed(a){check_admin_prizes_positions(a)}function check_admin_pools_prize(a){var e=parseInt(a.value.replace(/[\.|,|\s]/g,""));e<1e4||e>3e5?input_error(a,_("Valor incorrecto")):input_ok(a)}function check_admin_payments_member(a){var e=parseInt(a.value.replace(/[\.|,|\s]/g,""));e<-1e7||e>1e7?input_error(a,_("Valor incorrecto")):input_ok(a)}$("#popup").on("change","#select-new-admin",(function(){req_leave.admin=0!==parseInt($(this).val()),$("#btn-send").prop("disabled",!(req_leave.admin&&req_leave.check))})),$("#popup").on("input","input.check",(function(){var a=$(this).val().toLowerCase(),e=$(this).data("word").toLowerCase();req_leave.check=a==e,0===$("#select-new-admin").length&&(req_leave.admin=!0),$("#btn-send").prop("disabled",!(req_leave.admin&&req_leave.check))})),$("#popup").on("click","#btn-set",(function(){var a=$(this);btn_lock(a);var e=!1;if("member"==$("form input[name=action]").val()){var s=$("form select[name=member]").val();if(s.indexOf("%%")>-1){s=s.split("%%");var t=$("form input[name=amount]").val().replace(/[\.|,]/g,"");add_member(s[0],s[1],t),e=!0}else toast(_("Debes elegir un miembro"),"red")}btn_unlock(a),e&&history.back()})),$("body").on("click",".btn-community-settings",(function(){sendEvent("select_gameroom_settings",{from:"more"})})),$("body").on("click","#btn-admin-payments-send",(function(){var a=$(this);btn_lock(a);var e=$("#admin-payments-members li").map((function(){return $(this).data()})).get(),s=$("input[name=reason]").val();e.length>0&&s?$.ajax({url:"ajax/admin",data:"action=payment&reason="+s+"&members="+JSON.stringify(e),success:function(e){"ok"==e.status&&(toast(_("Bonificación realizada con éxito")),btn_unlock(a),$("#admin-payments-members").empty(),update_balance())},complete:function(){btn_unlock(a)}}):(toast(_("No has añadido ningún miembro o asunto"),"red"),btn_unlock(a))})),$("body").on("click","#btn-admin-cancel-transfers-send",(function(){var a=$('input[name="transfers[]"]:checked:enabled').map((function(){return $(this).val()})).get(),e={transfers:a};a.length>0?popup_open("admin-tools-cancel-transfers-confirm",e,$(this),!1):toast(_("No has seleccionado ningún fichaje"),"red")})),$("body").on("click",".btn-user-actions",(function(){$(".user-actions-menu").remove();var a=$(this),e=a.data("id"),s=a.data();s.cfg=_cfg,"undefined"!=typeof data&&(s.data=data),template=Twig.twig({data:$("#twig-admin-tools-members-actions").text()}).render(s),$("#user-"+e).find(".user-list-actions").append(template),setTimeout((function(){$("#user-"+e).find(".user-actions-menu").addClass("show")}),1)})),$("body").on("click",".btn-user-actions-close",(function(){$(".user-actions-menu.show").removeClass("show"),setTimeout((function(){$(".user-actions-menu").remove()}),50)})),$("body").on("click","#btn-icon-reset",(function(){$(".emoji-value").text(_cfg.user.communities[_cfg.user.id_community].flag_emoji),$("input[name=value]").val("")})),$("body").on("change","select.market_speed",(function(){1==$(this).val()?$(".mid-cycle-offer").removeClass("disabled"):$(".mid-cycle-offer").addClass("disabled")})),$("body").on("click",".panels-emoji .btn",(function(){var a=$(this);$(".emoji-value").text(a.text()),$("input[name=value]").val(a.text())}));